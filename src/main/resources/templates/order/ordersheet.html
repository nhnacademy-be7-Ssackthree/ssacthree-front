<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>주문서 작성</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
        h2 { background-color: #fddde6; padding: 10px; }
        label { display: block; margin: 5px 0; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #f8cdd2; padding: 8px; text-align: center; }
        section { margin: 20px 0; padding: 10px; border: 1px solid #f8cdd2; }
        .total { font-weight: bold; margin-top: 10px; }
    </style>

    <!-- 카카오 주소 API 추가 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>

<h1>주문서 작성 페이지</h1>

<!-- 1. 주문 상품 정보 -->
<section id="order-items">
    <h2>주문 상품 정보</h2>
    <table>
        <thead>
        <tr>
            <th>도서명</th>
            <th>가격</th>
            <th>적립 마일리지</th>
            <th>수량</th>
            <th>쿠폰 적용</th>
            <th>포장지 선택</th>
            <th>책별 총 금액</th>
        </tr>
        </thead>
        <tbody id="items-table-body">
        <!-- 상품 행이 JavaScript로 추가됩니다 -->
        </tbody>
    </table>
    <p class="total">총 예상금액: <span id="estimated-total">0원</span></p>
</section>

<script>
    // 예시 상품 데이터 배열
    const items = [];

    // 쿠폰 리스트
    const coupons = [
        { value: 0, text: "쿠폰 선택" },
        { value: 1000, text: "1,000원 할인 쿠폰" },
        { value: 2000, text: "2,000원 할인 쿠폰" }
    ];

    // 아이템 생성 함수
    function renderItems() {
        const tableBody = document.getElementById("items-table-body");
        tableBody.innerHTML = ""; // 초기화

        items.forEach((item, index) => {
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${item.name}</td>
                <td>${item.price}원</td>
                <td>${item.mileage}포인트</td>
                <td><input type="number" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, this.value)"></td>
                <td>
                    <select onchange="applyCoupon(${index}, this.value)">
                        ${coupons.map(coupon => `<option value="${coupon.value}">${coupon.text}</option>`).join('')}
                    </select>
                </td>
                <td>
                    <select onchange="applyWrapping(${index}, this.value)">
                        <option value="0">선택 없음</option>
                        <option value="500">기본 포장지 (+500원)</option>
                        <option value="1000">고급 포장지 (+1000원)</option>
                    </select>
                </td>
                <td><span id="total-price-${index}">${item.price}원</span></td>
            `;

            tableBody.appendChild(row);
        });

        updateEstimatedTotal();
    }

    // 수량 업데이트
    function updateQuantity(index, quantity) {
        items[index].quantity = parseInt(quantity, 10);
        updateTotalPrice(index);
    }

    // 쿠폰 적용
    function applyCoupon(index, discount) {
        items[index].coupon = parseInt(discount, 10);
        updateTotalPrice(index);
    }

    // 포장지 선택
    function applyWrapping(index, wrappingCost) {
        items[index].wrapping = parseInt(wrappingCost, 10);
        updateTotalPrice(index);
    }

    // 책별 총 금액 업데이트
    function updateTotalPrice(index) {
        const item = items[index];
        const totalPrice = (item.price * item.quantity) - (item.coupon || 0) + (item.wrapping || 0);
        document.getElementById(`total-price-${index}`).innerText = `${totalPrice}원`;
        updateEstimatedTotal();
    }

    // 총 예상 금액 계산
    function updateEstimatedTotal() {
        const estimatedTotal = items.reduce((sum, item) => {
            return sum + (item.price * item.quantity) - (item.coupon || 0) + (item.wrapping || 0);
        }, 0);

        document.getElementById("estimated-total").innerText = `${estimatedTotal}원`;
    }

    // 상품 목록 초기 렌더링
    renderItems();
</script>

<!-- 2. 구매자 정보 입력 -->
<section id="buyer-info">
    <h2>구매자 정보 입력</h2>
    <label>이름: <input type="text" id="buyer-name" required></label>
    <label>이메일: <input type="email" id="buyer-email" required></label>
    <label>휴대폰번호: <input type="tel" id="buyer-phone" required></label>
</section>

<!-- 3. 배송지 입력 -->
<section id="delivery-info">
    <h2>배송지 입력</h2>
    <label>주소 선택:
        <select id="address-list" onchange="setSelectedAddress()">
            <option>주소 선택</option>
            <!-- 회원 주소 리스트 추가 -->
        </select>
    </label>
    <label>받는 사람 이름: <input type="text" id="recipient-name" required></label>
    <button onclick="openPostcodeSearch()">주소 조회</button>
    <label>우편 주소: <input type="text" id="postal-code" readonly onclick="openPostcodeSearch()"></label>
    <label>도로명 주소: <input type="text" id="road-address" readonly onclick="openPostcodeSearch()"></label>
    <label>상세 주소: <input type="text" id="detail-address" required></label>
    <label>배송 날짜 지정: <input type="date" id="delivery-date" required></label>
</section>

<script>
    function openPostcodeSearch() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById("postal-code").value = data.zonecode;
                document.getElementById("road-address").value = data.roadAddress;
                document.getElementById("detail-address").focus();
            }
        }).open();
    }

    function setSelectedAddress() {}
</script>

<!-- 4. 포인트 사용 -->
<section id="point-use">
    <h2>포인트 사용</h2>
    <label>보유 포인트: <span id="user-points">2000 포인트</span></label>
    <label>사용할 포인트: <input type="number" id="points-to-use" max="2000" onchange="applyPoints()"></label>
</section>

<!-- 5. 결제 버튼 -->
<section id="payment-section">
    <button onclick="processOrder()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer;">결제하기</button>
</section>

<script>
    function processOrder() {
        const name = document.getElementById("buyer-name").value;
        const email = document.getElementById("buyer-email").value;
        const phone = document.getElementById("buyer-phone").value;
        const recipient = document.getElementById("recipient-name").value;
        const address = document.getElementById("road-address").value;
        const detailAddress = document.getElementById("detail-address").value;

        if (!name || !email || !phone || !recipient || !address || !detailAddress) {
            alert("필수 정보를 모두 입력해주세요.");
            return;
        }

        alert("주문이 완료되었습니다!");
    }

    function applyPoints() {
        const points = parseInt(document.getElementById("points-to-use").value) || 0;
        const total = parseInt(document.getElementById("estimated-total").innerText.replace("원", ""));
        const newTotal = total - points;

        document.getElementById("estimated-total").innerText = (newTotal > 0 ? newTotal : 0) + "원";
    }
</script>

</body>
</html>
